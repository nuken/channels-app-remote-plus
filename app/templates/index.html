<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Channels Remote Plus</title>
	<link rel="manifest" href="/static/manifest.json">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script>
        (function() {
            // Get the saved theme from localStorage, default to 'default-light'
            const savedTheme = localStorage.getItem('selectedTheme') || 'default-light';
            console.log("Inline script: Initial savedTheme from localStorage:", savedTheme); // Debugging line

            // If a theme other than default-light is saved, apply its class to the html element
            if (savedTheme && savedTheme !== 'default-light') {
                document.documentElement.classList.add(`theme-${savedTheme}`); // MODIFIED: Only target document.documentElement
                console.log(`Inline script: Applied theme-${savedTheme} to <html>.`); // Debugging line
            }

            // Define a placeholder applyTheme function to avoid errors if the select's onchange
            // fires before the main script.js is fully loaded and parsed.
            window.applyTheme = window.applyTheme || function() {};
        })();
    </script>
</head>
<body>
    <div class="container">
        <h1>Channels App Remote Plus</h1>

        <div style="margin-bottom: 20px;">
            <label for="theme-select" style="margin-right: 10px;">Select Theme:</label>
            <select id="theme-select" onchange="applyTheme()">
                <option value="default-light">Default Light</option>
                <option value="light-purple">Light (Purple Buttons)</option>
                <option value="dark-gray">Dark (Gray Buttons)</option>
                <option value="dark-green">Dark (Green Buttons)</option>
            </select>
        </div>

        <div class="config-info">
            <p><strong>Configured Clients:</strong></p>
            <select id="client-select" onchange="selectClient()">
                <option value="">Select a Client</option>
                {% for client in clients %}
                   <option value="{{ client.ip }}">{{ client.name }} ({{ client.ip }})</option>
                {% endfor %}
            </select>
            {% if not clients_configured %}
                <p style="color: red;">No clients configured. Set CHANNELS_APP_CLIENTS environment variable.</p>
            {% endif %}
            <p>
                <strong>Select Channels DVR Server:</strong><br>
                <select id="dvr-server-select" onchange="selectDvrServer()">
                    <option value="">Select a DVR Server</option>
                    {% for server in dvr_servers %}
                        <option value="{{ server.ip }}">{{ server.name }} ({{ server.ip }})</option>
                    {% endfor %}
                </select>
                {% if not dvr_servers_configured %}
                    <p style="color: red;">No DVR servers configured. Set CHANNELS_DVR_SERVERS environment variable.</p>
                {% endif %}
               <div id="dvr-server-ip-display" style="display: none;"></div></p>
        </div>

        <div style="margin-bottom: 20px;">
            <input type="checkbox" id="enablePopups" checked>
            <label for="enablePopups">Show Status Notifications (Recommended: Off for mobile)</label>
        </div>


        <h2>Playback Controls</h2>
        <div class="button-grid">
            <button class="control-button" onclick="sendCommand('toggle_pause')">Play/Pause</button>
            <button class="control-button" onclick="sendCommand('stop')">Stop</button>
            <button class="control-button" onclick="sendCommand('toggle_mute')">Mute</button>
            <button class="control-button" onclick="sendCommand('toggle_cc')">CC</button>
            <button class="control-button" onclick="toggleCcAndMute()">CC/Mute</button>
            <button class="control-button" onclick="rewindAndEnableCC()">Back 15/CC</button>
            <button class="control-button" onclick="sendCommand('channel_up')">Ch Up</button>
            <button class="control-button" onclick="sendCommand('channel_down')">Ch Down</button>
            <button class="control-button" onclick="sendCommand('previous_channel')">Previous Ch</button>
        </div>

        <div class="seek-controls input-group">
            <input type="number" id="seek_amount_input" value="30" placeholder="Secs"> <button class="control-button" onclick="sendSeekCommand(-1 * document.getElementById('seek_amount_input').value)">Go Back</button>
            <button class="control-button" onclick="sendSeekCommand(document.getElementById('seek_amount_input').value)">Go Forward</button>
        </div>

        <div class="input-group">
            <input type="number" id="manual_channel_input" placeholder="Enter Channel #"> <button class="control-button" onclick="sendCommand('play_channel', document.getElementById('manual_channel_input').value)">Go</button>
        </div>

        <div class="channel-list-section">
            <h2>Live TV Favorite Channels</h2>
            <select id="channel-select" class="control-button" onchange="tuneToSelectedChannel()">
                <option value="">Select a Channel</option>
                </select>
            <div class="refresh-button-container">
                <button class="control-button" onclick="loadChannels()">Refresh Favorites</button>
            </div>
            <p style="font-size: 0.8em; margin-top: 5px;">Fetches favorite channels directly from the selected Channels App client.</p>
        </div>


        <h2>Navigation</h2>
        <div class="button-grid">
            <button class="control-button" onclick="sendCommand('navigate', 'Live TV')">Go to Live TV</button>
            <button class="control-button" onclick="sendCommand('navigate', 'Guide')">Go to Guide</button>
            <button class="control-button" onclick="sendCommand('navigate', 'Library')">Go to Library</button>
            <button class="control-button" onclick="sendCommand('navigate', 'Search')">Go to Search</button>
        </div>

        <div id="movies-list-section">
            <div class="section-header">
                <h2>Movies</h2>
                <button class="section-toggle-button" onclick="toggleSection('movies-carousel-wrapper', this)">Hide Content</button>
            </div>
            <div class="filter-sort-controls">
                <label for="movies-search">Search:</label>
                <input type="search" id="movies-search" placeholder="Search movies by title/summary">

                <label for="movies-sort-by">Sort By:</label>
                <select id="movies-sort-by">
                    <option value="date_released">Release Date</option>
                    <option value="alpha">Title</option>
                    <option value="duration">Duration</option>
                </select>

                <label for="movies-sort-order">Order:</label>
                <select id="movies-sort-order">
                    <option value="desc">Descending</option>
                    <option value="asc">Ascending</option>
                </select>
            </div>

            <div id="movies-carousel-wrapper" class="carousel-wrapper">
                <button class="scroll-arrow left" onmousedown="startAutoScroll(document.getElementById('movies-list'), -1, event)" onmouseup="stopAutoScroll()" onmouseleave="stopAutoScroll()" ontouchstart="startAutoScroll(document.getElementById('movies-list'), -1, event)" ontouchend="stopAutoScroll()" ontouchcancel="stopAutoScroll()">&#9664;</button>
                <div id="movies-list">
                </div>
                <button class="scroll-arrow right" onmousedown="startAutoScroll(document.getElementById('movies-list'), 1, event)" onmouseup="stopAutoScroll()" onmouseleave="stopAutoScroll()" ontouchstart="startAutoScroll(document.getElementById('movies-list'), 1, event)" ontouchend="stopAutoScroll()" ontouchcancel="stopAutoScroll()">&#9654;</button>
            </div>
        </div>

        <div id="shows-list-section">
            <div class="section-header">
                <h2>TV Shows (Recent Episodes)</h2>
                <button class="section-toggle-button" onclick="toggleSection('episodes-carousel-wrapper', this)">Hide Content</button>
            </div>
            <div class="filter-sort-controls">
                <label for="shows-search">Search:</label>
                <input type="search" id="shows-search" placeholder="Search shows/episodes by title/summary">

                <label for="shows-sort-by">Sort By:</label>
                <select id="shows-sort-by">
                    <option value="date_aired">Air Date</option>
                    <option value="title">Show Title</option> 
                    <option value="episode_title">Episode Title</option> 
                    <option value="date_added">Date Added</option>
                    <option value="duration">Duration</option>
                </select>

                <label for="shows-sort-order">Order:</label>
                <select id="shows-sort-order">
                    <option value="desc">Descending</option>
                    <option value="asc">Ascending</option>
                </select>
            </div>
            <div id="episodes-carousel-wrapper" class="carousel-wrapper">
                <button class="scroll-arrow left" onmousedown="startAutoScroll(document.getElementById('episodes-list'), -1, event)" onmouseup="stopAutoScroll()" onmouseleave="stopAutoScroll()" ontouchstart="startAutoScroll(document.getElementById('episodes-list'), -1, event)" ontouchend="stopAutoScroll()" ontouchcancel="stopAutoScroll()">&#9664;</button>
                <div id="episodes-list">
                </div>
                <button class="scroll-arrow right" onmousedown="startAutoScroll(document.getElementById('episodes-list'), 1, event)" onmouseup="stopAutoScroll()" onmouseleave="stopAutoScroll()" ontouchstart="startAutoScroll(document.getElementById('episodes-list'), 1, event)" ontouchend="stopAutoScroll()" ontouchcancel="stopAutoScroll()">&#9654;</button>
            </div>
        </div>

        <div class="status-section">
            <h2>Current Device Status</h2>
            <button class="control-button" onclick="getStatus()">Refresh Status</button>
            <div id="now-playing-display" class="hidden">
                </div>
            <pre id="status-display" style="margin-top: 10px;"></pre>
        </div>
    </div>

    <div id="notification-area"></div>

    <script>
        const flaskClients = {{ clients | tojson }};
        const clientsConfiguredViaEnv = {{ clients_configured | tojson }};
        const flaskDvrServers = {{ dvr_servers | tojson }};
        const dvrServersConfiguredViaEnv = {{ dvr_servers_configured | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>